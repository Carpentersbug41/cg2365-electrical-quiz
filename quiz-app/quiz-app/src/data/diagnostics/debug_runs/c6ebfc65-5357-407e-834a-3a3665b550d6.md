# Phase 10 Debug Report

**Run ID:** c6ebfc65-5357-407e-834a-3a3665b550d6
**Lesson:** 203-3ABC - 203-3ABC — Circuit Types: What They Do
**Timestamp:** 2026-02-06T22:09:53.887Z

## Outcome

- **Baseline Score:** 93/100
- **Refined Score:** 88/100
- **Delta:** -5 points
- **Accepted:** No

## Scores by Section

| Section | Before | After | Delta |
|---------|--------|-------|-------|
| beginnerClarityStaging: Vocab block at blocks[1] is missing a definition for 'Alarm ... | 0/2 | 0/3 | 0 |
| markingRobustness: Integrative questions at blocks[8] (INT-1, INT-2) require mu... | 0/3 | 0/2 | 0 |
| questions: Grammar error in question 203-3ABC-C2-L2: 'explain how the c... | 0/1 | 0/2 | 0 |
| beginnerClarityStaging: The spaced-review block at blocks[9] note states 'Foundation... | 0/1 | 0/2 | 0 |
| visual: Explanations at blocks[3] and [5] do not explicitly referenc... | 0/1 | 0/1 | 0 |

## Issues Targeted

1. **[markingRobustness: Integrative questions at blocks[8] (INT-1, INT-2) require mu...]** Integrative questions at blocks[8] (INT-1, INT-2) require multi-sentence synthesis answers but use 'short-text' answerType. This will cause high failure rates for correct student answers due to rigid matching.
   - Suggestion: Cannot be fixed by Phase 10 - requires regeneration
   - Points lost: 3, Severity: 3.0

2. **[beginnerClarityStaging: Vocab block at blocks[1] is missing a definition for 'Alarm ...]** Vocab block at blocks[1] is missing a definition for 'Alarm Circuit', which is a primary learning outcome and appearing in practice questions. Violates teaching-before-testing.
   - Suggestion: Change blocks[1].content.terms from '[object Object],[object Object],[object Object],[object Object],[object Object]' to '[object Object],[object Object],[object Object],[object Object],[object Object],[object Object]'
   - Points lost: 2, Severity: 2.0

3. **[questions: Grammar error in question 203-3ABC-C2-L2: 'explain how the c...]** Grammar error in question 203-3ABC-C2-L2: 'explain how the choice of topology relate to' should be 'relates to'.
   - Suggestion: Modify blocks[6].content.questions[3].questionText
   - Points lost: 1, Severity: 1.0

4. **[beginnerClarityStaging: The spaced-review block at blocks[9] note states 'Foundation...]** The spaced-review block at blocks[9] note states 'Foundation check before starting', but the block is positioned at the end of the lesson, creating student confusion.
   - Suggestion: Modify blocks[9].content.notes
   - Points lost: 1, Severity: 1.0

5. **[visual: Explanations at blocks[3] and [5] do not explicitly referenc...]** Explanations at blocks[3] and [5] do not explicitly reference the split-view diagram, missing an opportunity to anchor the text to the visual evidence.
   - Suggestion: Prepend to blocks[3].content.content: 'Refer to the diagram to see how functional circuits like lighting and power are separated from the distribution board.

'
   - Points lost: 1, Severity: 1.0

## Patches Applied

### 1. Status: applied

- **Op:** replaceSubstring
- **Path:** `blocks[6].content.questions[3].questionText`
- **Old Value:** `"Using your answers to Q1 (loop circuits), Q2 (terminating circuits), and Q3 (lighting circuits), explain how the choice of topology relate to the circuit's purpose?"`
- **New Value:** `"relates to"`
- **Reason:** Corrected grammar error 'relate to' to 'relates to' in question text
- **Validation:** ✓ targetExists, ✓ fromMatches, ✓ safeStructure, ✓ allowedOp, ✓ allowedPath
- **Isolation (Sequential):** +3 total
- **Isolation (Independent):** +1 total

### 2. Status: applied

- **Op:** replaceSubstring
- **Path:** `blocks[9].content.notes`
- **Old Value:** `"Foundation check before starting Circuit Types: What They Do"`
- **New Value:** `"Final lesson review"`
- **Reason:** Corrected misleading note text for a block positioned at the end of the lesson
- **Validation:** ✓ targetExists, ✓ fromMatches, ✓ safeStructure, ✓ allowedOp, ✓ allowedPath
- **Isolation (Sequential):** -7 total
- **Isolation (Independent):** +5 total

### 3. Status: applied

- **Op:** prepend
- **Path:** `blocks[3].content.content`
- **Old Value:** `"### In this lesson\nYou will learn how to identify the primary types of electrical circuits used in domestic and commercial installations.\nThis lesson focuses on how circuits are categorized by their specific application within a building.\n\n*   Identify lighting, power, control, data, and alarm circuits.\n*   Understand the specific purposes of specialized functional circuits.\n*   Learn how to distinguish between high-voltage and extra-low voltage applications.\n\n**What this is**\nIn any electrical installation, we classify circuits based on what they do. A **Functional Circuit** is the general term for an electrical circuit defined by its specific application, such as providing light, power, or signaling. In a typical domestic or commercial setting, you will not find one single circuit doing everything. Instead, the installation is divided into several categories to ensure safety, facilitate maintenance, and prevent a single fault from plunging an entire building into darkness or disabling critical safety systems.\n\n**Why it matters**\nUnderstanding functional categories is essential for correct design and fault-finding. If an electrician cannot distinguish between a power circuit and a **Control Circuit**, they might accidentally connect high-voltage components to sensitive low-voltage regulators, leading to equipment failure or fire. Furthermore, BS 7671 (refer to current edition) requires the division of installations into circuits to avoid danger and minimize inconvenience in the event of a fault. By separating a **Data Circuit** from a power circuit, we also prevent electromagnetic interference from disrupting communication signals.\n\n**Key facts / rules**\n*   Installations must be divided into circuits to prevent a single fault from causing total loss of power.\n*   A **Control Circuit** is specifically designed to regulate the operation of other equipment, such as a boiler thermostat or a motor starter.\n*   A **Data Circuit** is used for information transmission and typically operates at extra-low voltage (ELV).\n*   Lighting circuits are typically separated from power circuits to ensure that if a socket-outlet trips, the lights remain functional.\n*   Emergency circuits, such as fire alarms or emergency lighting, often require specific cable types (fire-resistant) and dedicated paths.\n*   Identification of circuits must be clear at the distribution board using appropriate labeling.\n\n**When to choose it**\nYou choose a specific circuit type based on the equipment it serves. For example, you would select a lighting circuit for fixed luminaires in a warehouse. You would choose a **Control Circuit** when you need to switch a heavy load remotely or automatically, such as using a PIR sensor to trigger outdoor security lights. A **Data Circuit** is the correct choice when installing Ethernet cabling for an office network or connecting smart home devices. For safety-critical systems, such as smoke detectors or intruder alarms, you would choose a dedicated alarm circuit to ensure these systems are not affected by faults on general power circuits.\n\n**Common mistakes**\nA frequent error is mixing different functional types within the same enclosure or conduit without adequate separation, which can lead to signal interference or safety hazards. Another mistake is failing to label the distribution board correctly, making it difficult for future contractors to identify which circuit serves which purpose. Some installers also mistakenly use standard power cables for a **Data Circuit**, which can result in poor signal quality or data loss due to lack of shielding.\n\n**Key Points**\n*   A **Functional Circuit** is classified by its specific role, such as lighting or power.\n*   **Control Circuit** arrangements are used for regulation and switching logic.\n*   **Data Circuit** wiring is specialized for signal transmission and sensitive to interference.\n*   Separation of circuits is a core requirement of BS 7671 (refer to current edition).\n\n**Quick recap**\nElectrical installations are divided into different functional types to ensure safety and reliability. By identifying the primary types of electrical circuits used in domestic and commercial installations, such as lighting, power, alarm, and data, electricians can ensure that each system is designed and installed according to its specific purpose.\n\n### Coming Up Next\nWe will examine how these functional circuits are physically wired, comparing the loop-based principles of the ring final circuit with the linear layout of the radial circuit."`
- **New Value:** `"Refer to the diagram to see how functional circuits like lighting and power are separated from the distribution board.\n\n"`
- **Reason:** Added explicit reference to the diagram to anchor text to visual evidence
- **Validation:** ✓ targetExists, ✓ fromMatches, ✓ safeStructure, ✓ allowedOp, ✓ allowedPath
- **Isolation (Sequential):** +5 total
- **Isolation (Independent):** +3 total

## Postmortem Analysis

**Root Cause:** The refinement failed primarily due to structural corruption of block IDs, as evidenced by the ID Audit identifying 5 invalid IDs. Patch 2, while beneficial in isolation (+5), caused a significant regression (-7) when applied sequentially, indicating it likely corrupted the JSON structure or modified IDs globally rather than being scoped to the specific path.

**Harmful Patches:**
- Patch 2: Despite having a positive independent impact, its sequential impact was -7. The ID Audit shows that standard block IDs (outcomes, vocab, diagram) became invalid after patches were applied, suggesting Patch 2's 'replaceSubstring' operation likely performed a global replacement that corrupted block IDs or structural keys. (-7 points)

**Recommendations:**
- Recommendation 1: Implement an 'ID Integrity Guard' that prevents any patch from modifying strings that match the lesson's block ID pattern.
- Recommendation 2: Ensure the 'replaceSubstring' tool is strictly scoped to the value at the provided JSON path to prevent global string-matching errors.
- Recommendation 3: Add a validation rule that rejects the refinement if the sequential impact of any patch is negative, even if the independent impact is positive.
- Recommendation 4: For issues flagged as 'requires regeneration' (like the integrative questions), trigger a partial block regeneration instead of skipping them, as these often carry the highest point penalties.

## Changed Paths

- `blocks`

## ID Audit Issues

**Invalid IDs:**
- 203-3ABC-outcomes
- 203-3ABC-vocab
- 203-3ABC-diagram
- 203-3ABC-explain-1
- 203-3ABC-check-1
- 203-3ABC-explain-2
- 203-3ABC-check-2
- 203-3ABC-practice
- 203-3ABC-integrative
- 203-3ABC-spaced-review
